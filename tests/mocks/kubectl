#!/bin/bash
# Mock kubectl CLI for testing

CMD="$1"
shift

case "$CMD" in
  get)
    RESOURCE="$1"
    shift
    case "$RESOURCE" in
      deployment|deployment/*)
        # Check for -o json flag
        if [[ "$*" == *"-o json"* ]] || [[ "$*" == *"--output json"* ]]; then
          cat << 'MOCKJSON'
{
  "metadata": {"name": "my-app"},
  "spec": {
    "template": {
      "spec": {
        "containers": [{
          "name": "my-container",
          "env": [
            {"name": "API_KEY", "value": "live_api_key_456"},
            {"name": "DATABASE_URL", "value": "postgres://prod/mydb"},
            {"name": "OLD_VAR", "value": "should_be_removed"}
          ]
        }]
      }
    }
  }
}
MOCKJSON
        else
          echo "NAME      READY   UP-TO-DATE   AVAILABLE   AGE"
          echo "my-app    1/1     1            1           10d"
        fi
        exit 0
        ;;
      configmap|configmap/*)
        if [[ "$*" == *"-o json"* ]]; then
          cat << 'MOCKJSON'
{
  "metadata": {"name": "my-config"},
  "data": {
    "API_KEY": "live_api_key_456",
    "DATABASE_URL": "postgres://prod/mydb"
  }
}
MOCKJSON
        else
          echo "NAME        DATA   AGE"
          echo "my-config   2      10d"
        fi
        exit 0
        ;;
    esac
    ;;
  apply)
    echo "deployment.apps/my-app configured"
    exit 0
    ;;
  set)
    SUBCMD="$1"
    shift
    case "$SUBCMD" in
      env)
        echo "deployment.apps/my-app env updated"
        exit 0
        ;;
    esac
    ;;
  create)
    echo "resource created"
    exit 0
    ;;
  rollout)
    SUBCMD="$1"
    shift
    case "$SUBCMD" in
      status)
        echo "deployment \"my-app\" successfully rolled out"
        exit 0
        ;;
    esac
    ;;
  config)
    # Config commands
    exit 0
    ;;
esac

echo "Mock kubectl: unknown command $CMD $*"
exit 1
